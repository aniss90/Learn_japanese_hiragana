<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تعلم الهيراغانا - التمارين</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #E7D1D1;
            color: #333;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        header {
            background-color: #C48B8B;
            color: white;
            padding: 20px;
            text-align: center;
            border-radius: 8px;
            margin-bottom: 30px;
        }
        .back-btn {
            background-color: #DBB9B9;
            color: #333;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin-bottom: 20px;
            display: inline-block;
            text-decoration: none;
        }
        .stages-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .stage-card {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: all 0.3s;
            border: 2px solid #ddd;
            cursor: pointer;
        }
        .stage-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .stage-card.completed {
            border-color: #388e3c;
            background-color: #e8f5e9;
        }
        .stage-card.current {
            border-color: #1976d2;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(25, 118, 210, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(25, 118, 210, 0); }
            100% { box-shadow: 0 0 0 0 rgba(25, 118, 210, 0); }
        }
        .stage-title {
            font-size: 1.5rem;
            color: #d32f2f;
            margin-bottom: 15px;
            text-align: center;
        }
        .stage-chars {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }
        .stage-char {
            font-size: 1.8rem;
            text-align: center;
            width: 40px;
        }
        .stage-actions {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        .btn-learn {
            background-color: #1976d2;
            color: white;
        }
        .btn-practice {
            background-color: #388e3c;
            color: white;
        }
        .btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        .learn-section, .practice-section {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            margin-top: 30px;
            display: none;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .section-title {
            color: #d32f2f;
            text-align: center;
            margin-bottom: 25px;
        }
        .char-details {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 30px;
        }
        .current-char {
            font-size: 6rem;
            margin: 20px 0;
            color: #333;
        }
        .char-romaji {
            font-size: 2.5rem;
            color: #1976d2;
            font-weight: bold;
            margin: 10px 0;
        }
        .char-instruction {
            text-align: center;
            margin: 15px 0;
            font-size: 1.1rem;
        }
        .writing-steps {
            direction: ltr;
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background-color: #f5f5f5;
            border-radius: 5px;
            white-space: pre-line;
        }
        .nav-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
        }
        .exercise-options {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            margin: 30px 0;
        }
        .option-btn {
            padding: 12px 25px;
            background-color: #e0e0e0;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s;
        }
        .option-btn:hover {
            background-color: #C79090;
            color: white;
        }
        .feedback {
            font-size: 1.3rem;
            font-weight: bold;
            margin: 25px 0;
            min-height: 40px;
            text-align: center;
            padding: 10px;
            border-radius: 5px;
        }
        .correct {
            color: #388e3c;
            background-color: #e8f5e9;
        }
        .incorrect {
            color: #d32f2f;
            background-color: #ffebee;
        }
        .progress-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 25px 0;
        }
        .progress-text {
            font-weight: bold;
            font-size: 1.1rem;
        }
        .return-btn {
            background-color: #757575;
            color: white;
        }
        .practice-now-btn {
            background-color: #388e3c;
            color: white;
            padding: 15px 30px;
            font-size: 1.2rem;
            margin: 20px auto;
            display: block;
            width: fit-content;
        }
        .achievements {
            display: flex;
            justify-content: space-around;
            margin: 30px 0;
            text-align: center;
        }
        .achievement-box {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            flex: 1;
            margin: 0 10px;
        }
        .achievement-value {
            font-size: 2.5rem;
            color: #d32f2f;
            font-weight: bold;
        }
        .achievement-label {
            font-size: 1.1rem;
            color: #333;
        }
        @media (max-width: 768px) {
            .stages-container {
                grid-template-columns: 1fr;
            }
            .nav-buttons {
                flex-direction: column;
                gap: 10px;
            }
            .achievements {
                flex-direction: column;
            }
            .achievement-box {
                margin: 10px 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>تمارين الهيراغانا</h1>
            <p>اختر مرحلة لبدء التعلم والتمرين</p>
        </header>

        <a href="general.html" class="back-btn">العودة للصفحة العامة</a>

        <div class="achievements">
            <div class="achievement-box">
                <div class="achievement-value" id="completedStagesCount">0</div>
                <div class="achievement-label">مرحلة مكتملة</div>
            </div>
            <div class="achievement-box">
                <div class="achievement-value" id="learnedCharsCount">0</div>
                <div class="achievement-label">حرف متعلم</div>
            </div>
        </div>



        <div id="stages-view">
            <h2>المراحل التعليمية</h2>
            <div class="stages-container" id="stagesContainer"></div>
        </div>

        <div id="learn-section" class="learn-section">
            <h2 class="section-title">تعلم أحرف المرحلة</h2>
            <div class="progress-container">
                <div class="progress-text" id="learnProgress"></div>
                <button class="btn return-btn" id="returnFromLearn">العودة للمراحل</button>
            </div>
            
            <div class="char-details">
                <div class="current-char" id="learnChar"></div>
                <div class="char-romaji" id="learnRomaji"></div>
                <div class="char-instruction" id="learnInstruction"></div>
                
                <div class="writing-steps" id="writingSteps"></div>
            </div>
            
            <div class="nav-buttons">
                <button class="btn" id="prevChar">السابق</button>
                <button class="btn btn-practice" id="startPractice">بدأ التمارين</button>
                <button class="btn" id="nextChar">التالي</button>
            </div>
        </div>

        <div id="practice-section" class="practice-section">
            <h2 class="section-title">تمارين المرحلة</h2>
            <div class="progress-container">
                <div class="progress-text" id="exerciseProgress"></div>
                <button class="btn return-btn" id="returnFromPractice">العودة للمراحل</button>
            </div>
            
            <div class="char-details">
                <div class="current-char" id="exerciseChar"></div>
                <div class="char-instruction">اختر النطق الصحيح للحرف:</div>
                
                <div class="exercise-options" id="optionsContainer"></div>
                <div class="feedback" id="exerciseFeedback"></div>
            </div>
            
            <div class="nav-buttons">
                <button class="btn" id="nextExercise">التالي</button>
            </div>
        </div>
    </div>

    <script>
        // جميع أحرف الهيراغانا الأساسية (46 حرفاً) مصنفة في مراحل
        const stages = [
            {
                title: "المرحلة 1: أحرف الصف الأول (あـ)",
                chars: [
                    { char: 'あ', romaji: 'a', writing: '1. ابدأ بالخط الأفقي ←\n2. أضف الخط العمودي ↓\n3. أخيراً الخط المنحني' },
                    { char: 'い', romaji: 'i', writing: '1. الخط المائل من اليسار ↓\n2. الخط المائل من اليمين ↓' },
                    { char: 'う', romaji: 'u', writing: '1. ابدأ بالخط المنحني الصغير\n2. أضف الخط الطويل المنحني' },
                    { char: 'え', romaji: 'e', writing: '1. الخط الأفلي ←\n2. الخط العمودي ↓\n3. الخط المائل ↘' },
                    { char: 'お', romaji: 'o', writing: '1. الخط الأفلي القصير\n2. الخط المنحني الكبير\n3. النقطة الصغيرة' }
                ]
            },
            {
                title: "المرحلة 2: أحرف الصف الثاني (かـ)",
                chars: [
                    { char: 'か', romaji: 'ka', writing: '1. الخط المائل ↘\n2. الخط الأفلي ←\n3. الخط المنحني' },
                    { char: 'き', romaji: 'ki', writing: '1. الخط الأفلي ←\n2. الخط العمودي ↓\n3. الخطوط المائلة' },
                    { char: 'く', romaji: 'ku', writing: '1. خط منحني واحد ↙' },
                    { char: 'け', romaji: 'ke', writing: '1. الخط العمودي ↓\n2. الخط الأفلي ←\n3. الخط المائل ↘' },
                    { char: 'こ', romaji: 'ko', writing: '1. الخط الأفلي العلوي ←\n2. الخط الأفلي السفلي ←' }
                ]
            },
            {
                title: "المرحلة 3: أحرف الصف الثالث (さـ)",
                chars: [
                    { char: 'さ', romaji: 'sa', writing: '1. الخط المائل ↘\n2. الخط الأفلي ←\n3. الخط المنحني' },
                    { char: 'し', romaji: 'shi', writing: '1. خط منحني واحد ↓' },
                    { char: 'す', romaji: 'su', writing: '1. الخط العمودي ↓\n2. الخط المنحني الصغير\n3. الخط المنحني الكبير' },
                    { char: 'せ', romaji: 'se', writing: '1. الخط العمودي ↓\n2. الخط الأفلي ←\n3. الخط المائل ↘' },
                    { char: 'そ', romaji: 'so', writing: '1. ابدأ بالخط المنحني الصغير\n2. أضف الخطوط المنحنية المتتالية' }
                ]
            },
            {
                title: "المرحلة 4: أحرف الصف الرابع (たـ)",
                chars: [
                    { char: 'た', romaji: 'ta', writing: '1. الخط المائل ↘\n2. الخط الأفلي ←\n3. الخط المنحني' },
                    { char: 'ち', romaji: 'chi', writing: '1. الخط المائل ↘\n2. الخط المنحني' },
                    { char: 'つ', romaji: 'tsu', writing: '1. خط منحني واحد يشبه "Z"' },
                    { char: 'て', romaji: 'te', writing: '1. الخط العمودي ↓\n2. الخط المنحني' },
                    { char: 'と', romaji: 'to', writing: '1. الخط الأفلي ←\n2. الخط المنحني' }
                ]
            },
            {
                title: "المرحلة 5: أحرف الصف الخامس (なـ)",
                chars: [
                    { char: 'な', romaji: 'na', writing: '1. الخط المائل ↘\n2. الخط الأفلي ←\n3. الخط المنحني' },
                    { char: 'に', romaji: 'ni', writing: '1. الخط العمودي ↓\n2. الخطوط المائلة' },
                    { char: 'ぬ', romaji: 'nu', writing: '1. الخط المنحني الأول\n2. الخط المنحني المتقاطع' },
                    { char: 'ね', romaji: 'ne', writing: '1. الخط العمودي ↓\n2. الخط المنحني المتعرج' },
                    { char: 'の', romaji: 'no', writing: '1. خط منحني واحد يشبه الدائرة' }
                ]
            },
            {
                title: "المرحلة 6: أحرف الصف السادس (はـ)",
                chars: [
                    { char: 'は', romaji: 'ha', writing: '1. الخط المائل ↘\n2. الخط الأفلي ←\n3. الخط المنحني' },
                    { char: 'ひ', romaji: 'hi', writing: '1. خط منحني متعرج' },
                    { char: 'ふ', romaji: 'fu', writing: '1. الخط الأفلي القصير\n2. الخط المائل ↘\n3. الخط المنحني' },
                    { char: 'へ', romaji: 'he', writing: '1. خط منحني واحد يشبه الموجة' },
                    { char: 'ほ', romaji: 'ho', writing: '1. الخط العمودي ↓\n2. الخط الأفلي ←\n3. الخط المائل ↘' }
                ]
            },
            {
                title: "المرحلة 7: أحرف الصف السابع (まـ)",
                chars: [
                    { char: 'ま', romaji: 'ma', writing: '1. الخط العمودي ↓\n2. الخط الأفلي ←\n3. الخط المنحني' },
                    { char: 'み', romaji: 'mi', writing: '1. الخط العمودي ↓\n2. الخطوط المائلة' },
                    { char: 'む', romaji: 'mu', writing: '1. الخط العمودي ↓\n2. الخط المنحني المتعرج' },
                    { char: 'め', romaji: 'me', writing: '1. الخط العمودي ↓\n2. الخط المنحني' },
                    { char: 'も', romaji: 'mo', writing: '1. الخط العمودي ↓\n2. الخط الأفلي ←\n3. الخط المنحني' }
                ]
            },
            {
                title: "المرحلة 8: أحرف الصف الثامن (やـ)",
                chars: [
                    { char: 'や', romaji: 'ya', writing: '1. الخط المائل ↘\n2. الخط المنحني' },
                    { char: 'ゆ', romaji: 'yu', writing: '1. الخط العمودي ↓\n2. الخط المنحني' },
                    { char: 'よ', romaji: 'yo', writing: '1. الخط الأفلي ←\n2. الخط المنحني' }
                ]
            },
            {
                title: "المرحلة 9: أحرف الصف التاسع (らـ)",
                chars: [
                    { char: 'ら', romaji: 'ra', writing: '1. الخط المائل ↘\n2. الخط المنحني' },
                    { char: 'り', romaji: 'ri', writing: '1. الخط العمودي ↓\n2. الخط المائل ↘' },
                    { char: 'る', romaji: 'ru', writing: '1. الخط العمودي ↓\n2. الخط المنحني' },
                    { char: 'れ', romaji: 're', writing: '1. الخط العمودي ↓\n2. الخط المنحني' },
                    { char: 'ろ', romaji: 'ro', writing: '1. الخط العمودي ↓\n2. الخط المنحني' }
                ]
            },
            {
                title: "المرحلة 10: الأحرف المتبقية",
                chars: [
                    { char: 'わ', romaji: 'wa', writing: '1. الخط المائل ↘\n2. الخط المنحني' },
                    { char: 'を', romaji: 'wo', writing: '1. الخط المائل ↘\n2. الخط المنحني' },
                    { char: 'ん', romaji: 'n', writing: '1. خط منحني متعرج' }
                ]
            }
        ];

        // عناصر واجهة المستخدم
        const stagesContainer = document.getElementById('stagesContainer');
        const stagesView = document.getElementById('stages-view');
        const learnSection = document.getElementById('learn-section');
        const practiceSection = document.getElementById('practice-section');
        const completedStagesCount = document.getElementById('completedStagesCount');
        const learnedCharsCount = document.getElementById('learnedCharsCount');
        
        // عناصر قسم التعلم
        const learnChar = document.getElementById('learnChar');
        const learnRomaji = document.getElementById('learnRomaji');
        const learnInstruction = document.getElementById('learnInstruction');
        const writingSteps = document.getElementById('writingSteps');
        const learnProgress = document.getElementById('learnProgress');
        const prevCharBtn = document.getElementById('prevChar');
        const nextCharBtn = document.getElementById('nextChar');
        const startPracticeBtn = document.getElementById('startPractice');
        const returnFromLearnBtn = document.getElementById('returnFromLearn');
        
        // عناصر قسم التمارين
        const exerciseChar = document.getElementById('exerciseChar');
        const exerciseProgress = document.getElementById('exerciseProgress');
        const optionsContainer = document.getElementById('optionsContainer');
        const exerciseFeedback = document.getElementById('exerciseFeedback');
        const nextExerciseBtn = document.getElementById('nextExercise');
        const returnFromPracticeBtn = document.getElementById('returnFromPractice');

        // متغيرات التطبيق
        let currentStage = 0;
        let currentCharIndex = 0;
        let currentExerciseIndex = 0;
        let correctAnswers = 0;
        let completedStages = JSON.parse(localStorage.getItem('completedStages')) || [];
        let learnedChars = JSON.parse(localStorage.getItem('learnedChars')) || [];

        // عرض المراحل
        function renderStages() {
            stagesContainer.innerHTML = '';
            
            stages.forEach((stage, index) => {
                const stageCard = document.createElement('div');
                stageCard.className = 'stage-card';
                
                if (completedStages.includes(index)) {
                    stageCard.classList.add('completed');
                } else if (index === 0 || completedStages.includes(index - 1)) {
                    stageCard.classList.add('current');
                }
                
                stageCard.innerHTML = `
                    <h3 class="stage-title">${stage.title}</h3>
                    <div class="stage-chars">
                        ${stage.chars.map(char => `<div class="stage-char">${char.char}</div>`).join('')}
                    </div>
                `;
                
                stageCard.addEventListener('click', () => {
                    if (index === 0 || completedStages.includes(index - 1)) {
                        startStage(index);
                    }
                });
                
                stagesContainer.appendChild(stageCard);
            });
            
            updateAchievements();
        }

        // بدء مرحلة جديدة
        function startStage(stageIndex) {
            currentStage = stageIndex;
            currentCharIndex = 0;
            showLearnView();
            updateLearnView();
        }

        // عرض واجهة التعلم
        function showLearnView() {
            stagesView.style.display = 'none';
            learnSection.style.display = 'block';
            practiceSection.style.display = 'none';
        }

        // تحديث واجهة التعلم
        function updateLearnView() {
            const stage = stages[currentStage];
            const char = stage.chars[currentCharIndex];
            
            learnChar.textContent = char.char;
            learnRomaji.textContent = char.romaji;
            learnInstruction.textContent = `تعلم كيفية كتابة ${char.char} (${char.romaji})`;
            writingSteps.textContent = char.writing;
            
            learnProgress.textContent = `الحرف ${currentCharIndex + 1} من ${stage.chars.length} - المرحلة ${currentStage + 1}`;
            
            prevCharBtn.disabled = currentCharIndex === 0;
            nextCharBtn.disabled = currentCharIndex === stage.chars.length - 1;
            
            // تسجيل الحرف كمتعلم إذا لم يكن مسجلاً من قبل
            const charKey = `${currentStage}-${currentCharIndex}`;
            if (!learnedChars.includes(charKey)) {
                learnedChars.push(charKey);
                localStorage.setItem('learnedChars', JSON.stringify(learnedChars));
                updateAchievements();
            }
        }

        // عرض واجهة التمارين
        function showPracticeView() {
            stagesView.style.display = 'none';
            learnSection.style.display = 'none';
            practiceSection.style.display = 'block';
            
            currentExerciseIndex = 0;
            correctAnswers = 0;
            generateExercise();
        }

        // إنشاء تمرين جديد
        function generateExercise() {
            const stage = stages[currentStage];
            const exerciseCharObj = stage.chars[currentExerciseIndex];
            
            exerciseChar.textContent = exerciseCharObj.char;
            exerciseProgress.textContent = `السؤال ${currentExerciseIndex + 1} من ${stage.chars.length} - المرحلة ${currentStage + 1}`;
            
            // إنشاء خيارات متعددة
            optionsContainer.innerHTML = '';
            exerciseFeedback.textContent = '';
            exerciseFeedback.className = 'feedback';
            
            // جمع جميع خيارات الروماجي الممكنة
            let allRomaji = [];
            stages.forEach(s => {
                s.chars.forEach(c => {
                    if (!allRomaji.includes(c.romaji)) {
                        allRomaji.push(c.romaji);
                    }
                });
            });
            
            // اختيار 3 خيارات عشوائية بالإضافة إلى الإجابة الصحيحة
            let options = [exerciseCharObj.romaji];
            while (options.length < 4) {
                const randomIndex = Math.floor(Math.random() * allRomaji.length);
                const randomRomaji = allRomaji[randomIndex];
                if (!options.includes(randomRomaji)) {
                    options.push(randomRomaji);
                }
            }
            
            // خلط الخيارات
            options = shuffleArray(options);
            
            // عرض الخيارات
            options.forEach(option => {
                const optionBtn = document.createElement('button');
                optionBtn.className = 'option-btn';
                optionBtn.textContent = option;
                optionBtn.addEventListener('click', () => checkAnswer(option, exerciseCharObj.romaji));
                optionsContainer.appendChild(optionBtn);
            });
        }

        // التحقق من الإجابة
        function checkAnswer(selectedAnswer, correctAnswer) {
            const optionButtons = document.querySelectorAll('.option-btn');
            optionButtons.forEach(btn => {
                btn.disabled = true;
                if (btn.textContent === correctAnswer) {
                    btn.style.backgroundColor = '#388e3c';
                    btn.style.color = 'white';
                } else if (btn.textContent === selectedAnswer && selectedAnswer !== correctAnswer) {
                    btn.style.backgroundColor = '#d32f2f';
                    btn.style.color = 'white';
                }
            });
            
            if (selectedAnswer === correctAnswer) {
                exerciseFeedback.textContent = 'إجابة صحيحة! أحسنت!';
                exerciseFeedback.className = 'feedback correct';
                correctAnswers++;
            } else {
                exerciseFeedback.textContent = `إجابة خاطئة! الإجابة الصحيحة هي: ${correctAnswer}`;
                exerciseFeedback.className = 'feedback incorrect';
            }
            
            nextExerciseBtn.style.display = 'block';
        }

        // التمرين التالي
        function nextExercise() {
            const stage = stages[currentStage];
            currentExerciseIndex++;
            
            if (currentExerciseIndex < stage.chars.length) {
                generateExercise();
                nextExerciseBtn.style.display = 'none';
            } else {
                finishPractice();
            }
        }

        // إنهاء التمارين
        function finishPractice() {
            const stage = stages[currentStage];
            const score = Math.round((correctAnswers / stage.chars.length) * 100);
            
            // إذا أجاب المستخدم على 80% أو أكثر بشكل صحيح، يتم اعتبار المرحلة مكتملة
            if (score >= 80 && !completedStages.includes(currentStage)) {
                completedStages.push(currentStage);
                localStorage.setItem('completedStages', JSON.stringify(completedStages));
                updateAchievements();
            }
            
            alert(`انتهت تمارين المرحلة! نتيجتك: ${score}%`);
            returnToStages();
        }

        // العودة إلى قائمة المراحل
        function returnToStages() {
            stagesView.style.display = 'block';
            learnSection.style.display = 'none';
            practiceSection.style.display = 'none';
            renderStages();
        }

        // تحديث الإنجازات
        function updateAchievements() {
            completedStagesCount.textContent = completedStages.length;
            learnedCharsCount.textContent = learnedChars.length;
        }

        // دالة لخلط المصفوفة
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // أحداث الأزرار
        prevCharBtn.addEventListener('click', () => {
            currentCharIndex--;
            updateLearnView();
        });
        
        nextCharBtn.addEventListener('click', () => {
            currentCharIndex++;
            updateLearnView();
        });
        
        startPracticeBtn.addEventListener('click', showPracticeView);
        returnFromLearnBtn.addEventListener('click', returnToStages);
        returnFromPracticeBtn.addEventListener('click', returnToStages);
        nextExerciseBtn.addEventListener('click', nextExercise);

        // تهيئة التطبيق
        renderStages();
        updateAchievements();
    </script>
</body>
</html>